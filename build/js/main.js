"use strict";

function _typeof(obj) { "@babel/helpers - typeof"; return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && "function" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; }, _typeof(obj); }
function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); enumerableOnly && (symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; })), keys.push.apply(keys, symbols); } return keys; }
function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = null != arguments[i] ? arguments[i] : {}; i % 2 ? ownKeys(Object(source), !0).forEach(function (key) { _defineProperty(target, key, source[key]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } return target; }
function _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }
function _toPropertyKey(arg) { var key = _toPrimitive(arg, "string"); return _typeof(key) === "symbol" ? key : String(key); }
function _toPrimitive(input, hint) { if (_typeof(input) !== "object" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || "default"); if (_typeof(res) !== "object") return res; throw new TypeError("@@toPrimitive must return a primitive value."); } return (hint === "string" ? String : Number)(input); }
(function () {
  var PROMO_END_DATE = new Date('2024-10-22T18:30:00.000Z'); //-3 hours
  var apiURL = 'https://fav-prom.com/api_shakhtar_predictor';
  var resultsTable = document.querySelector('.table__body-scroll'),
    unauthMsgs = document.querySelectorAll('.unauth-msg'),
    youAreInBtns = document.querySelectorAll('.took-part'),
    predictionBtn = document.querySelector('.predict__btn'),
    yourBetTxt = document.querySelector('.predict__yourBet');
  var ukLeng = document.querySelector('#ukLeng');
  var enLeng = document.querySelector('#enLeng');
  var locale = 'uk';
  if (ukLeng) locale = 'uk';
  if (enLeng) locale = 'en';
  var i18nData = {};
  var userId;
  userId = 100300268;
  function loadTranslations() {
    return fetch("".concat(apiURL, "/translates/").concat(locale)).then(function (res) {
      return res.json();
    }).then(function (json) {
      i18nData = json;
      translate();
      var mutationObserver = new MutationObserver(function (mutations) {
        translate();
      });
      mutationObserver.observe(document.getElementById('shakhtar'), {
        childList: true,
        subtree: true
      });
    });
  }
  function translate() {
    var elems = document.querySelectorAll('[data-translate]');
    if (elems && elems.length) {
      elems.forEach(function (elem) {
        var key = elem.getAttribute('data-translate');
        elem.innerHTML = translateKey(key);
        elem.removeAttribute('data-translate');
      });
    }
    if (locale === 'en') {
      mainPage.classList.add('en');
    }
    refreshLocalizedClass();
  }
  function translateKey(key) {
    if (!key) {
      return;
    }
    return i18nData[key] || '*----NEED TO BE TRANSLATED----*   key:  ' + key;
  }
  function refreshLocalizedClass(element, baseCssClass) {
    if (!element) {
      return;
    }
    for (var _i = 0, _arr = ['uk', 'en']; _i < _arr.length; _i++) {
      var lang = _arr[_i];
      element.classList.remove(baseCssClass + lang);
    }
    element.classList.add(baseCssClass + locale);
  }
  var request = function request(link, extraOptions) {
    return fetch(apiURL + link, _objectSpread({
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      }
    }, extraOptions || {})).then(function (res) {
      return res.json();
    });
  };
  function getUsers() {
    return request('/users');
  }
  var InitPage = function InitPage() {
    getUsers().then(function (users) {
      renderUsers(users);
      translate();
    });
  };
  function init() {
    initScoreSelector(1);
    initScoreSelector(2);
    initPredictionBtn();
    if (window.store) {
      var state = window.store.getState();
      userId = state.auth.isAuthorized && state.auth.id || '';
      InitPage();
    } else {
      InitPage();
      var c = 0;
      var i = setInterval(function () {
        if (c < 50) {
          if (!!window.g_user_id) {
            userId = window.g_user_id;
            InitPage();
            checkUserAuth();
            clearInterval(i);
          }
        } else {
          clearInterval(i);
        }
      }, 200);
    }
    checkUserAuth();
  }
  function renderUsers(users) {
    populateUsersTable(users, userId, resultsTable);
  }
  function populateUsersTable(users, currentUserId, table) {
    table.innerHTML = '';
    if (users && users.length) {
      var currentUser = userId && users.find(function (user) {
        return user.userid === currentUserId;
      });
      if (currentUser) {
        displayUser(currentUser, true, table);
      }
      users.forEach(function (user) {
        if (user.userid !== currentUserId) {
          displayUser(user, false, table);
        }
      });
    }
  }
  function displayUser(user, isCurrentUser, table) {
    var additionalUserRow = document.createElement('div');
    additionalUserRow.classList.add('table__row');
    if (isCurrentUser) {
      updateLastPrediction(user);
      additionalUserRow.classList.add('you');
    }
    additionalUserRow.innerHTML = "\n                        <div class=\"table__row-item\">".concat(isCurrentUser ? user.userid : maskUserId(user.userid), "</div>\n                        <div class=\"table__row-item\">").concat(formatDateString(user.lastForecast), "</div>\n                        <div class=\"table__row-item\">").concat(user.team1, ":").concat(user.team2, "</div>\n                        <div class=\"table__row-item\">**************</div>\n                    ");
    table.append(additionalUserRow);
  }
  function updateLastPrediction(data) {
    var team1Label = document.querySelector('.scoreTeam1');
    var team2Label = document.querySelector('.scoreTeam2');
    team1Label.innerHTML = data.team1;
    team2Label.innerHTML = data.team2;

    // const trueBet = document.querySelector('.predict__bet-true');
    // const falseBet = document.querySelector('.predict__bet-false');
    // if (user.betConfirmed) {
    //     trueBet.classList.remove('hide');
    //     falseBet.classList.add('hide');
    // } else {
    //     trueBet.classList.add('hide');
    //     falseBet.classList.remove('hide');
    // }
  }

  function formatDateString(dateString) {
    var date = new Date(dateString);
    var day = date.getDate().toString().padStart(2, '0');
    var month = (date.getMonth() + 1).toString().padStart(2, '0');
    var year = date.getFullYear();
    var hours = date.getHours().toString().padStart(2, '0');
    var minutes = date.getMinutes().toString().padStart(2, '0');
    return "".concat(day, ".").concat(month, ".").concat(year, " / ").concat(hours, ":").concat(minutes);
  }
  function maskUserId(userId) {
    return "**" + userId.toString().slice(2);
  }
  var checkUserAuth = function checkUserAuth() {
    if (userId) {
      unauthMsgs.forEach(function (item) {
        return item.classList.add('hide');
      });
      youAreInBtns.forEach(function (item) {
        return item.classList.remove('hide');
      });
    }
  };
  var scorePrediction = {
    team1: 0,
    team2: 0
  };
  function initScoreSelector(teamNumber) {
    var minusBtn = document.querySelector(".team".concat(teamNumber, "-minus"));
    var plusBtn = document.querySelector(".team".concat(teamNumber, "-plus"));
    var scorePanel = document.querySelector(".predictionTeam".concat(teamNumber));
    minusBtn.addEventListener('click', function () {
      var fieldTag = "team".concat(teamNumber);
      var currentScore = scorePrediction[fieldTag];
      scorePrediction[fieldTag] = Math.max(currentScore - 1, 0);
      scorePanel.innerHTML = scorePrediction[fieldTag];
    });
    plusBtn.addEventListener('click', function () {
      var fieldTag = "team".concat(teamNumber);
      var currentScore = scorePrediction[fieldTag];
      scorePrediction[fieldTag] = Math.min(currentScore + 1, 99);
      scorePanel.innerHTML = scorePrediction[fieldTag];
    });
  }
  var isRequestInProgress;
  function initPredictionBtn() {
    document.addEventListener('click', function (e) {
      if (!!e.target.closest('.predict__btn')) {
        if (isRequestInProgress) {
          return;
        }
        yourBetTxt.classList.remove("hide");
        setTimeout(function () {
          youAreInBtns.forEach(function (item) {
            return item.classList.remove('showBtn');
          });
        }, 5000);
        youAreInBtns.forEach(function (item) {
          return item.classList.add('showBtn');
        });
        isRequestInProgress = true;
        predictionBtn.classList.add("pointer-none");
        request('/bet', {
          method: 'POST',
          body: JSON.stringify({
            userid: userId,
            team1: scorePrediction.team1,
            team2: scorePrediction.team2
          })
        }).then(function (res) {
          isRequestInProgress = false;
          predictionBtn.classList.remove("pointer-none");
          InitPage();
        })["catch"](function (e) {
          isRequestInProgress = false;
          predictionBtn.classList.remove("pointer-none");
        });
      }
    });
  }
  loadTranslations().then(init);
  var mainPage = document.querySelector('.fav-page');
  setTimeout(function () {
    return mainPage.classList.add('overflow');
  }, 1000);
  var currentDate = new Date();
  if (currentDate >= PROMO_END_DATE) {
    youAreInBtns.forEach(function (item) {
      return item.classList.add('block-btn');
    });
  }

  // popups
  function setPopups(popups, closeBtns, showBtns) {
    popups = document.querySelectorAll("".concat(popups));
    closeBtns = document.querySelectorAll("".concat(closeBtns));
    showBtns = document.querySelectorAll("".concat(showBtns));
    showBtns.forEach(function (showBtn, showBtnIndex) {
      showBtn.addEventListener("click", function () {
        popups.forEach(function (popup, popupIndex) {
          if (popupIndex === showBtnIndex) {
            popup.classList.toggle("active");
          } else {
            popup.classList.remove("active");
          }
        });
      });
    });
    closeBtns.forEach(function (showBtn, closeBtnIndex) {
      showBtn.addEventListener("click", function () {
        popups.forEach(function (popup, popupIndex) {
          if (popupIndex === closeBtnIndex) {
            popup.classList.remove("active");
          }
        });
      });
    });
  }
  setPopups(".guide__list-popup", ".guide__list-popup-close", ".guide__list-btn");

  // scroll add anim

  var tableLightning = document.querySelector('.table');
  var tableCup = document.querySelector('.table__cup');
  var tablePers = document.querySelector('.table__pers');
  var prizeLightning = document.querySelector('.prize');
  var promoTitle = document.querySelector('.promo__title');
  function animateOnScroll(element, animationClass) {
    var options = {
      root: null,
      rootMargin: '0px',
      threshold: 0.2
    };
    var observer = new IntersectionObserver(function (entries) {
      entries.forEach(function (entry) {
        if (entry.isIntersecting) {
          entry.target.classList.add(animationClass);
        } else {
          entry.target.classList.remove(animationClass);
        }
      });
    }, options);
    observer.observe(element);
  }
  animateOnScroll(tableLightning, "tableLightning");
  animateOnScroll(tableCup, "fadeInLeft");
  animateOnScroll(tablePers, "fadeInRight");
  animateOnScroll(prizeLightning, "prizeLightning");
  var titles = document.querySelectorAll(".title");
  titles.forEach(function (title) {
    animateOnScroll(title, "fadeIn");
  });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiUFJPTU9fRU5EX0RBVEUiLCJEYXRlIiwiYXBpVVJMIiwicmVzdWx0c1RhYmxlIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwidW5hdXRoTXNncyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJ5b3VBcmVJbkJ0bnMiLCJwcmVkaWN0aW9uQnRuIiwieW91ckJldFR4dCIsInVrTGVuZyIsImVuTGVuZyIsImxvY2FsZSIsImkxOG5EYXRhIiwidXNlcklkIiwibG9hZFRyYW5zbGF0aW9ucyIsImZldGNoIiwidGhlbiIsInJlcyIsImpzb24iLCJ0cmFuc2xhdGUiLCJtdXRhdGlvbk9ic2VydmVyIiwiTXV0YXRpb25PYnNlcnZlciIsIm11dGF0aW9ucyIsIm9ic2VydmUiLCJnZXRFbGVtZW50QnlJZCIsImNoaWxkTGlzdCIsInN1YnRyZWUiLCJlbGVtcyIsImxlbmd0aCIsImZvckVhY2giLCJlbGVtIiwia2V5IiwiZ2V0QXR0cmlidXRlIiwiaW5uZXJIVE1MIiwidHJhbnNsYXRlS2V5IiwicmVtb3ZlQXR0cmlidXRlIiwibWFpblBhZ2UiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZWZyZXNoTG9jYWxpemVkQ2xhc3MiLCJlbGVtZW50IiwiYmFzZUNzc0NsYXNzIiwibGFuZyIsInJlbW92ZSIsInJlcXVlc3QiLCJsaW5rIiwiZXh0cmFPcHRpb25zIiwiaGVhZGVycyIsImdldFVzZXJzIiwiSW5pdFBhZ2UiLCJ1c2VycyIsInJlbmRlclVzZXJzIiwiaW5pdCIsImluaXRTY29yZVNlbGVjdG9yIiwiaW5pdFByZWRpY3Rpb25CdG4iLCJ3aW5kb3ciLCJzdG9yZSIsInN0YXRlIiwiZ2V0U3RhdGUiLCJhdXRoIiwiaXNBdXRob3JpemVkIiwiaWQiLCJjIiwiaSIsInNldEludGVydmFsIiwiZ191c2VyX2lkIiwiY2hlY2tVc2VyQXV0aCIsImNsZWFySW50ZXJ2YWwiLCJwb3B1bGF0ZVVzZXJzVGFibGUiLCJjdXJyZW50VXNlcklkIiwidGFibGUiLCJjdXJyZW50VXNlciIsImZpbmQiLCJ1c2VyIiwidXNlcmlkIiwiZGlzcGxheVVzZXIiLCJpc0N1cnJlbnRVc2VyIiwiYWRkaXRpb25hbFVzZXJSb3ciLCJjcmVhdGVFbGVtZW50IiwidXBkYXRlTGFzdFByZWRpY3Rpb24iLCJtYXNrVXNlcklkIiwiZm9ybWF0RGF0ZVN0cmluZyIsImxhc3RGb3JlY2FzdCIsInRlYW0xIiwidGVhbTIiLCJhcHBlbmQiLCJkYXRhIiwidGVhbTFMYWJlbCIsInRlYW0yTGFiZWwiLCJkYXRlU3RyaW5nIiwiZGF0ZSIsImRheSIsImdldERhdGUiLCJ0b1N0cmluZyIsInBhZFN0YXJ0IiwibW9udGgiLCJnZXRNb250aCIsInllYXIiLCJnZXRGdWxsWWVhciIsImhvdXJzIiwiZ2V0SG91cnMiLCJtaW51dGVzIiwiZ2V0TWludXRlcyIsInNsaWNlIiwiaXRlbSIsInNjb3JlUHJlZGljdGlvbiIsInRlYW1OdW1iZXIiLCJtaW51c0J0biIsInBsdXNCdG4iLCJzY29yZVBhbmVsIiwiYWRkRXZlbnRMaXN0ZW5lciIsImZpZWxkVGFnIiwiY3VycmVudFNjb3JlIiwiTWF0aCIsIm1heCIsIm1pbiIsImlzUmVxdWVzdEluUHJvZ3Jlc3MiLCJlIiwidGFyZ2V0IiwiY2xvc2VzdCIsInNldFRpbWVvdXQiLCJtZXRob2QiLCJib2R5IiwiSlNPTiIsInN0cmluZ2lmeSIsImN1cnJlbnREYXRlIiwic2V0UG9wdXBzIiwicG9wdXBzIiwiY2xvc2VCdG5zIiwic2hvd0J0bnMiLCJzaG93QnRuIiwic2hvd0J0bkluZGV4IiwicG9wdXAiLCJwb3B1cEluZGV4IiwidG9nZ2xlIiwiY2xvc2VCdG5JbmRleCIsInRhYmxlTGlnaHRuaW5nIiwidGFibGVDdXAiLCJ0YWJsZVBlcnMiLCJwcml6ZUxpZ2h0bmluZyIsInByb21vVGl0bGUiLCJhbmltYXRlT25TY3JvbGwiLCJhbmltYXRpb25DbGFzcyIsIm9wdGlvbnMiLCJyb290Iiwicm9vdE1hcmdpbiIsInRocmVzaG9sZCIsIm9ic2VydmVyIiwiSW50ZXJzZWN0aW9uT2JzZXJ2ZXIiLCJlbnRyaWVzIiwiZW50cnkiLCJpc0ludGVyc2VjdGluZyIsInRpdGxlcyIsInRpdGxlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBLENBQUMsWUFBWTtFQUNULElBQU1BLGNBQWMsR0FBRyxJQUFJQyxJQUFJLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxDQUFDO0VBQzdELElBQU1DLE1BQU0sR0FBRyw2Q0FBNkM7RUFFNUQsSUFDSUMsWUFBWSxHQUFHQyxRQUFRLENBQUNDLGFBQWEsQ0FBQyxxQkFBcUIsQ0FBQztJQUM1REMsVUFBVSxHQUFHRixRQUFRLENBQUNHLGdCQUFnQixDQUFDLGFBQWEsQ0FBQztJQUNyREMsWUFBWSxHQUFHSixRQUFRLENBQUNHLGdCQUFnQixDQUFDLFlBQVksQ0FBQztJQUN0REUsYUFBYSxHQUFHTCxRQUFRLENBQUNDLGFBQWEsQ0FBQyxlQUFlLENBQUM7SUFDdkRLLFVBQVUsR0FBR04sUUFBUSxDQUFDQyxhQUFhLENBQUMsbUJBQW1CLENBQUM7RUFFNUQsSUFBTU0sTUFBTSxHQUFHUCxRQUFRLENBQUNDLGFBQWEsQ0FBQyxTQUFTLENBQUM7RUFDaEQsSUFBTU8sTUFBTSxHQUFHUixRQUFRLENBQUNDLGFBQWEsQ0FBQyxTQUFTLENBQUM7RUFFaEQsSUFBSVEsTUFBTSxHQUFHLElBQUk7RUFFakIsSUFBSUYsTUFBTSxFQUFFRSxNQUFNLEdBQUcsSUFBSTtFQUN6QixJQUFJRCxNQUFNLEVBQUVDLE1BQU0sR0FBRyxJQUFJO0VBRXpCLElBQUlDLFFBQVEsR0FBRyxDQUFDLENBQUM7RUFDakIsSUFBSUMsTUFBTTtFQUNWQSxNQUFNLEdBQUcsU0FBUztFQUVsQixTQUFTQyxnQkFBZ0IsR0FBRztJQUN4QixPQUFPQyxLQUFLLFdBQUlmLE1BQU0seUJBQWVXLE1BQU0sRUFBRyxDQUFDSyxJQUFJLENBQUMsVUFBQUMsR0FBRztNQUFBLE9BQUlBLEdBQUcsQ0FBQ0MsSUFBSSxFQUFFO0lBQUEsRUFBQyxDQUNqRUYsSUFBSSxDQUFDLFVBQUFFLElBQUks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SyxFQUFFLFFBQVEsQ0FBQztFQUNwQyxDQUFDLENBQUM7QUFFTixDQUFDLEdBQUciLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgUFJPTU9fRU5EX0RBVEUgPSBuZXcgRGF0ZSgnMjAyNC0xMC0yMlQxODozMDowMC4wMDBaJyk7IC8vLTMgaG91cnNcbiAgICBjb25zdCBhcGlVUkwgPSAnaHR0cHM6Ly9mYXYtcHJvbS5jb20vYXBpX3NoYWtodGFyX3ByZWRpY3Rvcic7XG5cbiAgICBjb25zdFxuICAgICAgICByZXN1bHRzVGFibGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGFibGVfX2JvZHktc2Nyb2xsJyksXG4gICAgICAgIHVuYXV0aE1zZ3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudW5hdXRoLW1zZycpLFxuICAgICAgICB5b3VBcmVJbkJ0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudG9vay1wYXJ0JyksXG4gICAgICAgIHByZWRpY3Rpb25CdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJlZGljdF9fYnRuJyksXG4gICAgICAgIHlvdXJCZXRUeHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJlZGljdF9feW91ckJldCcpO1xuXG4gICAgY29uc3QgdWtMZW5nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3VrTGVuZycpO1xuICAgIGNvbnN0IGVuTGVuZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNlbkxlbmcnKTtcblxuICAgIGxldCBsb2NhbGUgPSAndWsnO1xuXG4gICAgaWYgKHVrTGVuZykgbG9jYWxlID0gJ3VrJztcbiAgICBpZiAoZW5MZW5nKSBsb2NhbGUgPSAnZW4nO1xuXG4gICAgbGV0IGkxOG5EYXRhID0ge307XG4gICAgbGV0IHVzZXJJZDtcbiAgICB1c2VySWQgPSAxMDAzMDAyNjhcblxuICAgIGZ1bmN0aW9uIGxvYWRUcmFuc2xhdGlvbnMoKSB7XG4gICAgICAgIHJldHVybiBmZXRjaChgJHthcGlVUkx9L3RyYW5zbGF0ZXMvJHtsb2NhbGV9YCkudGhlbihyZXMgPT4gcmVzLmpzb24oKSlcbiAgICAgICAgICAgIC50aGVuKGpzb24gPT4ge1xuICAgICAgICAgICAgICAgIGkxOG5EYXRhID0ganNvbjtcbiAgICAgICAgICAgICAgICB0cmFuc2xhdGUoKTtcblxuICAgICAgICAgICAgICAgIHZhciBtdXRhdGlvbk9ic2VydmVyID0gbmV3IE11dGF0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24gKG11dGF0aW9ucykge1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2xhdGUoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBtdXRhdGlvbk9ic2VydmVyLm9ic2VydmUoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NoYWtodGFyJyksIHtcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRMaXN0OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBzdWJ0cmVlOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB0cmFuc2xhdGUoKSB7XG4gICAgICAgIGNvbnN0IGVsZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnW2RhdGEtdHJhbnNsYXRlXScpXG4gICAgICAgIGlmIChlbGVtcyAmJiBlbGVtcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGVsZW1zLmZvckVhY2goZWxlbSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3Qga2V5ID0gZWxlbS5nZXRBdHRyaWJ1dGUoJ2RhdGEtdHJhbnNsYXRlJyk7XG4gICAgICAgICAgICAgICAgZWxlbS5pbm5lckhUTUwgPSB0cmFuc2xhdGVLZXkoa2V5KTtcbiAgICAgICAgICAgICAgICBlbGVtLnJlbW92ZUF0dHJpYnV0ZSgnZGF0YS10cmFuc2xhdGUnKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICBpZiAobG9jYWxlID09PSAnZW4nKSB7XG4gICAgICAgICAgICBtYWluUGFnZS5jbGFzc0xpc3QuYWRkKCdlbicpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVmcmVzaExvY2FsaXplZENsYXNzKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gdHJhbnNsYXRlS2V5KGtleSkge1xuICAgICAgICBpZiAoIWtleSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpMThuRGF0YVtrZXldIHx8ICcqLS0tLU5FRUQgVE8gQkUgVFJBTlNMQVRFRC0tLS0qICAga2V5OiAgJyArIGtleTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZWZyZXNoTG9jYWxpemVkQ2xhc3MoZWxlbWVudCwgYmFzZUNzc0NsYXNzKSB7XG4gICAgICAgIGlmICghZWxlbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgbGFuZyBvZiBbJ3VrJywgJ2VuJ10pIHtcbiAgICAgICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShiYXNlQ3NzQ2xhc3MgKyBsYW5nKTtcbiAgICAgICAgfVxuICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoYmFzZUNzc0NsYXNzICsgbG9jYWxlKTtcbiAgICB9XG5cbiAgICBjb25zdCByZXF1ZXN0ID0gZnVuY3Rpb24gKGxpbmssIGV4dHJhT3B0aW9ucykge1xuICAgICAgICByZXR1cm4gZmV0Y2goYXBpVVJMICsgbGluaywge1xuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC4uLihleHRyYU9wdGlvbnMgfHwge30pXG4gICAgICAgIH0pLnRoZW4ocmVzID0+IHJlcy5qc29uKCkpXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZ2V0VXNlcnMoKSB7XG4gICAgICAgIHJldHVybiByZXF1ZXN0KCcvdXNlcnMnKTtcbiAgICB9XG5cbiAgICBjb25zdCBJbml0UGFnZSA9ICgpID0+IHtcbiAgICAgICAgZ2V0VXNlcnMoKS50aGVuKHVzZXJzID0+IHtcbiAgICAgICAgICAgIHJlbmRlclVzZXJzKHVzZXJzKTtcbiAgICAgICAgICAgIHRyYW5zbGF0ZSgpO1xuICAgICAgICB9KVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGluaXQoKSB7XG4gICAgICAgIGluaXRTY29yZVNlbGVjdG9yKDEpO1xuICAgICAgICBpbml0U2NvcmVTZWxlY3RvcigyKTtcbiAgICAgICAgaW5pdFByZWRpY3Rpb25CdG4oKTtcblxuICAgICAgICBpZiAod2luZG93LnN0b3JlKSB7XG4gICAgICAgICAgICB2YXIgc3RhdGUgPSB3aW5kb3cuc3RvcmUuZ2V0U3RhdGUoKTtcbiAgICAgICAgICAgIHVzZXJJZCA9IHN0YXRlLmF1dGguaXNBdXRob3JpemVkICYmIHN0YXRlLmF1dGguaWQgfHwgJyc7XG4gICAgICAgICAgICBJbml0UGFnZSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgSW5pdFBhZ2UoKTtcbiAgICAgICAgICAgIGxldCBjID0gMDtcbiAgICAgICAgICAgIHZhciBpID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmIChjIDwgNTApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEhd2luZG93LmdfdXNlcl9pZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcklkID0gd2luZG93LmdfdXNlcl9pZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIEluaXRQYWdlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja1VzZXJBdXRoKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKGkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAyMDApO1xuICAgICAgICB9XG5cbiAgICAgICAgY2hlY2tVc2VyQXV0aCgpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlbmRlclVzZXJzKHVzZXJzKSB7XG4gICAgICAgIHBvcHVsYXRlVXNlcnNUYWJsZSh1c2VycywgdXNlcklkLCByZXN1bHRzVGFibGUpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHBvcHVsYXRlVXNlcnNUYWJsZSh1c2VycywgY3VycmVudFVzZXJJZCwgdGFibGUpIHtcbiAgICAgICAgdGFibGUuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgIGlmICh1c2VycyAmJiB1c2Vycy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gdXNlcklkICYmIHVzZXJzLmZpbmQodXNlciA9PiB1c2VyLnVzZXJpZCA9PT0gY3VycmVudFVzZXJJZCk7XG4gICAgICAgICAgICBpZiAoY3VycmVudFVzZXIpIHtcbiAgICAgICAgICAgICAgICBkaXNwbGF5VXNlcihjdXJyZW50VXNlciwgdHJ1ZSwgdGFibGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB1c2Vycy5mb3JFYWNoKCh1c2VyKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHVzZXIudXNlcmlkICE9PSBjdXJyZW50VXNlcklkKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpc3BsYXlVc2VyKHVzZXIsIGZhbHNlLCB0YWJsZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkaXNwbGF5VXNlcih1c2VyLCBpc0N1cnJlbnRVc2VyLCB0YWJsZSkge1xuICAgICAgICBjb25zdCBhZGRpdGlvbmFsVXNlclJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBhZGRpdGlvbmFsVXNlclJvdy5jbGFzc0xpc3QuYWRkKCd0YWJsZV9fcm93Jyk7XG4gICAgICAgIGlmIChpc0N1cnJlbnRVc2VyKSB7XG4gICAgICAgICAgICB1cGRhdGVMYXN0UHJlZGljdGlvbih1c2VyKTtcbiAgICAgICAgICAgIGFkZGl0aW9uYWxVc2VyUm93LmNsYXNzTGlzdC5hZGQoJ3lvdScpO1xuICAgICAgICB9XG5cbiAgICAgICAgYWRkaXRpb25hbFVzZXJSb3cuaW5uZXJIVE1MID0gYFxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cInRhYmxlX19yb3ctaXRlbVwiPiR7aXNDdXJyZW50VXNlciA/IHVzZXIudXNlcmlkIDogbWFza1VzZXJJZCh1c2VyLnVzZXJpZCl9PC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwidGFibGVfX3Jvdy1pdGVtXCI+JHtmb3JtYXREYXRlU3RyaW5nKHVzZXIubGFzdEZvcmVjYXN0KX08L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0YWJsZV9fcm93LWl0ZW1cIj4ke3VzZXIudGVhbTF9OiR7dXNlci50ZWFtMn08L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJ0YWJsZV9fcm93LWl0ZW1cIj4qKioqKioqKioqKioqKjwvZGl2PlxuICAgICAgICAgICAgICAgICAgICBgO1xuICAgICAgICB0YWJsZS5hcHBlbmQoYWRkaXRpb25hbFVzZXJSb3cpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHVwZGF0ZUxhc3RQcmVkaWN0aW9uKGRhdGEpIHtcbiAgICAgICAgY29uc3QgdGVhbTFMYWJlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zY29yZVRlYW0xJyk7XG4gICAgICAgIGNvbnN0IHRlYW0yTGFiZWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2NvcmVUZWFtMicpO1xuICAgICAgICB0ZWFtMUxhYmVsLmlubmVySFRNTCA9IGRhdGEudGVhbTE7XG4gICAgICAgIHRlYW0yTGFiZWwuaW5uZXJIVE1MID0gZGF0YS50ZWFtMlxuXG4gICAgICAgIC8vIGNvbnN0IHRydWVCZXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJlZGljdF9fYmV0LXRydWUnKTtcbiAgICAgICAgLy8gY29uc3QgZmFsc2VCZXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJlZGljdF9fYmV0LWZhbHNlJyk7XG4gICAgICAgIC8vIGlmICh1c2VyLmJldENvbmZpcm1lZCkge1xuICAgICAgICAvLyAgICAgdHJ1ZUJldC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlJyk7XG4gICAgICAgIC8vICAgICBmYWxzZUJldC5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XG4gICAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAgIC8vICAgICB0cnVlQmV0LmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcbiAgICAgICAgLy8gICAgIGZhbHNlQmV0LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUnKTtcbiAgICAgICAgLy8gfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGZvcm1hdERhdGVTdHJpbmcoZGF0ZVN0cmluZykge1xuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoZGF0ZVN0cmluZyk7XG5cbiAgICAgICAgY29uc3QgZGF5ID0gZGF0ZS5nZXREYXRlKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAnMCcpO1xuICAgICAgICBjb25zdCBtb250aCA9IChkYXRlLmdldE1vbnRoKCkgKyAxKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7XG4gICAgICAgIGNvbnN0IHllYXIgPSBkYXRlLmdldEZ1bGxZZWFyKCk7XG4gICAgICAgIGNvbnN0IGhvdXJzID0gZGF0ZS5nZXRIb3VycygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTtcbiAgICAgICAgY29uc3QgbWludXRlcyA9IGRhdGUuZ2V0TWludXRlcygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKTtcblxuICAgICAgICByZXR1cm4gYCR7ZGF5fS4ke21vbnRofS4ke3llYXJ9IC8gJHtob3Vyc306JHttaW51dGVzfWA7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gbWFza1VzZXJJZCh1c2VySWQpIHtcbiAgICAgICAgcmV0dXJuIFwiKipcIiArIHVzZXJJZC50b1N0cmluZygpLnNsaWNlKDIpO1xuICAgIH1cblxuICAgIGxldCBjaGVja1VzZXJBdXRoID0gKCkgPT4ge1xuICAgICAgICBpZiAodXNlcklkKSB7XG4gICAgICAgICAgICB1bmF1dGhNc2dzLmZvckVhY2goaXRlbSA9PiBpdGVtLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKSk7XG4gICAgICAgICAgICB5b3VBcmVJbkJ0bnMuZm9yRWFjaChpdGVtID0+IGl0ZW0uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZScpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHNjb3JlUHJlZGljdGlvbiA9IHt0ZWFtMSA6IDAsIHRlYW0yOiAwfVxuXG4gICAgZnVuY3Rpb24gaW5pdFNjb3JlU2VsZWN0b3IodGVhbU51bWJlcikge1xuICAgICAgICBjb25zdCBtaW51c0J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC50ZWFtJHt0ZWFtTnVtYmVyfS1taW51c2ApO1xuICAgICAgICBjb25zdCBwbHVzQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLnRlYW0ke3RlYW1OdW1iZXJ9LXBsdXNgKTtcbiAgICAgICAgY29uc3Qgc2NvcmVQYW5lbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYC5wcmVkaWN0aW9uVGVhbSR7dGVhbU51bWJlcn1gKTtcblxuICAgICAgICBtaW51c0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkVGFnID0gYHRlYW0ke3RlYW1OdW1iZXJ9YDtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTY29yZSA9IHNjb3JlUHJlZGljdGlvbltmaWVsZFRhZ107XG4gICAgICAgICAgICBzY29yZVByZWRpY3Rpb25bZmllbGRUYWddID0gTWF0aC5tYXgoY3VycmVudFNjb3JlIC0gMSwgMCk7XG4gICAgICAgICAgICBzY29yZVBhbmVsLmlubmVySFRNTCA9IHNjb3JlUHJlZGljdGlvbltmaWVsZFRhZ107XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHBsdXNCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBmaWVsZFRhZyA9IGB0ZWFtJHt0ZWFtTnVtYmVyfWA7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50U2NvcmUgPSBzY29yZVByZWRpY3Rpb25bZmllbGRUYWddO1xuICAgICAgICAgICAgc2NvcmVQcmVkaWN0aW9uW2ZpZWxkVGFnXSA9IE1hdGgubWluKGN1cnJlbnRTY29yZSArIDEsIDk5KTtcbiAgICAgICAgICAgIHNjb3JlUGFuZWwuaW5uZXJIVE1MID0gc2NvcmVQcmVkaWN0aW9uW2ZpZWxkVGFnXTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgbGV0IGlzUmVxdWVzdEluUHJvZ3Jlc3M7XG4gICAgZnVuY3Rpb24gaW5pdFByZWRpY3Rpb25CdG4oKSB7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpID0+IHtcbiAgICAgICAgICAgIGlmICghIWUudGFyZ2V0LmNsb3Nlc3QoJy5wcmVkaWN0X19idG4nKSkge1xuICAgICAgICAgICAgICAgIGlmIChpc1JlcXVlc3RJblByb2dyZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVyblxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB5b3VyQmV0VHh0LmNsYXNzTGlzdC5yZW1vdmUoXCJoaWRlXCIpO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHlvdUFyZUluQnRucy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5jbGFzc0xpc3QucmVtb3ZlKCdzaG93QnRuJykpO1xuICAgICAgICAgICAgICAgIH0sIDUwMDApO1xuICAgICAgICAgICAgICAgIHlvdUFyZUluQnRucy5mb3JFYWNoKGl0ZW0gPT4gaXRlbS5jbGFzc0xpc3QuYWRkKCdzaG93QnRuJykpO1xuICAgICAgICAgICAgICAgIGlzUmVxdWVzdEluUHJvZ3Jlc3MgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHByZWRpY3Rpb25CdG4uY2xhc3NMaXN0LmFkZChcInBvaW50ZXItbm9uZVwiKTtcbiAgICAgICAgICAgICAgICByZXF1ZXN0KCcvYmV0Jywge1xuICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlcmlkOiB1c2VySWQsXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZWFtMTogc2NvcmVQcmVkaWN0aW9uLnRlYW0xLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGVhbTI6IHNjb3JlUHJlZGljdGlvbi50ZWFtMlxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH0pLnRoZW4ocmVzID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaXNSZXF1ZXN0SW5Qcm9ncmVzcyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBwcmVkaWN0aW9uQnRuLmNsYXNzTGlzdC5yZW1vdmUoXCJwb2ludGVyLW5vbmVcIik7XG4gICAgICAgICAgICAgICAgICAgIEluaXRQYWdlKCk7XG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlzUmVxdWVzdEluUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgcHJlZGljdGlvbkJ0bi5jbGFzc0xpc3QucmVtb3ZlKFwicG9pbnRlci1ub25lXCIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIGxvYWRUcmFuc2xhdGlvbnMoKVxuICAgICAgICAudGhlbihpbml0KTtcblxuICAgIGxldCBtYWluUGFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5mYXYtcGFnZScpO1xuICAgIHNldFRpbWVvdXQoKCkgPT4gbWFpblBhZ2UuY2xhc3NMaXN0LmFkZCgnb3ZlcmZsb3cnKSwgMTAwMCk7XG5cbiAgICBjb25zdCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgaWYoY3VycmVudERhdGUgPj0gUFJPTU9fRU5EX0RBVEUpIHtcbiAgICAgICAgeW91QXJlSW5CdG5zLmZvckVhY2goaXRlbSA9PiBpdGVtLmNsYXNzTGlzdC5hZGQoJ2Jsb2NrLWJ0bicpKTtcbiAgICB9XG5cbiAgICAvLyBwb3B1cHNcbiAgICBmdW5jdGlvbiBzZXRQb3B1cHMocG9wdXBzLCBjbG9zZUJ0bnMsIHNob3dCdG5zKXtcbiAgICAgICAgcG9wdXBzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgJHtwb3B1cHN9YClcbiAgICAgICAgY2xvc2VCdG5zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChgJHtjbG9zZUJ0bnN9YClcbiAgICAgICAgc2hvd0J0bnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKGAke3Nob3dCdG5zfWApXG5cbiAgICAgICAgc2hvd0J0bnMuZm9yRWFjaCgoc2hvd0J0biwgc2hvd0J0bkluZGV4KSA9PiB7XG4gICAgICAgICAgICBzaG93QnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PntcbiAgICAgICAgICAgICAgICBwb3B1cHMuZm9yRWFjaCgocG9wdXAsIHBvcHVwSW5kZXgpID0+e1xuICAgICAgICAgICAgICAgICAgICBpZihwb3B1cEluZGV4ID09PSBzaG93QnRuSW5kZXgpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9wdXAuY2xhc3NMaXN0LnRvZ2dsZShcImFjdGl2ZVwiKVxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJhY3RpdmVcIilcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KVxuICAgICAgICB9KVxuICAgICAgICBjbG9zZUJ0bnMuZm9yRWFjaCgoc2hvd0J0biwgY2xvc2VCdG5JbmRleCkgPT4ge1xuICAgICAgICAgICAgc2hvd0J0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT57XG4gICAgICAgICAgICAgICAgcG9wdXBzLmZvckVhY2goKHBvcHVwLCBwb3B1cEluZGV4KSA9PntcbiAgICAgICAgICAgICAgICAgICAgaWYocG9wdXBJbmRleCA9PT0gY2xvc2VCdG5JbmRleCl7XG4gICAgICAgICAgICAgICAgICAgICAgICBwb3B1cC5jbGFzc0xpc3QucmVtb3ZlKFwiYWN0aXZlXCIpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfSlcbiAgICAgICAgfSlcblxuICAgIH1cblxuICAgIHNldFBvcHVwcyhcIi5ndWlkZV9fbGlzdC1wb3B1cFwiLCBcIi5ndWlkZV9fbGlzdC1wb3B1cC1jbG9zZVwiLCBcIi5ndWlkZV9fbGlzdC1idG5cIilcblxuICAgIC8vIHNjcm9sbCBhZGQgYW5pbVxuXG4gICAgY29uc3QgdGFibGVMaWdodG5pbmcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGFibGUnKTtcbiAgICBjb25zdCB0YWJsZUN1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy50YWJsZV9fY3VwJyk7XG4gICAgY29uc3QgdGFibGVQZXJzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRhYmxlX19wZXJzJyk7XG4gICAgY29uc3QgcHJpemVMaWdodG5pbmcgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJpemUnKTtcbiAgICBjb25zdCBwcm9tb1RpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByb21vX190aXRsZScpO1xuXG4gICAgZnVuY3Rpb24gYW5pbWF0ZU9uU2Nyb2xsKGVsZW1lbnQsIGFuaW1hdGlvbkNsYXNzKSB7XG4gICAgICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICAgICAgICByb290OiBudWxsLFxuICAgICAgICAgICAgcm9vdE1hcmdpbjogJzBweCcsXG4gICAgICAgICAgICB0aHJlc2hvbGQ6IDAuMlxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IG9ic2VydmVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKChlbnRyaWVzKSA9PiB7XG4gICAgICAgICAgICBlbnRyaWVzLmZvckVhY2goZW50cnkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlbnRyeS5pc0ludGVyc2VjdGluZykge1xuICAgICAgICAgICAgICAgICAgICBlbnRyeS50YXJnZXQuY2xhc3NMaXN0LmFkZChhbmltYXRpb25DbGFzcyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZW50cnkudGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoYW5pbWF0aW9uQ2xhc3MpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCBvcHRpb25zKTtcblxuICAgICAgICBvYnNlcnZlci5vYnNlcnZlKGVsZW1lbnQpO1xuICAgIH1cbiAgICBhbmltYXRlT25TY3JvbGwodGFibGVMaWdodG5pbmcsIFwidGFibGVMaWdodG5pbmdcIilcbiAgICBhbmltYXRlT25TY3JvbGwodGFibGVDdXAsIFwiZmFkZUluTGVmdFwiKVxuICAgIGFuaW1hdGVPblNjcm9sbCh0YWJsZVBlcnMsIFwiZmFkZUluUmlnaHRcIilcbiAgICBhbmltYXRlT25TY3JvbGwocHJpemVMaWdodG5pbmcsIFwicHJpemVMaWdodG5pbmdcIilcblxuICAgIGNvbnN0IHRpdGxlcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIudGl0bGVcIilcblxuICAgIHRpdGxlcy5mb3JFYWNoKHRpdGxlID0+e1xuICAgICAgICBhbmltYXRlT25TY3JvbGwodGl0bGUsIFwiZmFkZUluXCIpXG4gICAgfSlcblxufSkoKTtcbiJdfQ==
